package adminpages

import (
	"github.com/btassone/obtura/internal/models"
	"github.com/btassone/obtura/web/templates/admin/layout"
)

templ MediaUpload(user *models.User) {
	@adminlayout.AdminBase("Upload Media", user) {
		<div class="mb-8">
			<h1 class="text-2xl font-semibold text-gray-900">Upload Media</h1>
			<p class="mt-1 text-sm text-gray-600">Upload images, documents, and other files</p>
		</div>

		<div class="bg-white shadow sm:rounded-lg">
			<div class="px-4 py-5 sm:p-6">
				<!-- Upload Area -->
				<div class="max-w-3xl mx-auto">
					<form class="space-y-6">
						<div>
							<label class="block text-sm font-medium text-gray-700">
								Drop files here or click to upload
							</label>
							<div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors cursor-pointer">
								<div class="space-y-1 text-center">
									<svg class="mx-auto h-16 w-16 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
										<path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
									</svg>
									<div class="flex text-sm text-gray-600">
										<label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
											<span>Upload files</span>
											<input id="file-upload" name="file-upload" type="file" multiple class="sr-only"/>
										</label>
										<p class="pl-1">or drag and drop</p>
									</div>
									<p class="text-xs text-gray-500">PNG, JPG, GIF, PDF, DOC up to 50MB each</p>
								</div>
							</div>
						</div>

						<!-- Upload Progress (hidden by default) -->
						<div id="upload-progress" class="hidden">
							<h3 class="text-sm font-medium text-gray-700 mb-2">Uploading...</h3>
							<div class="space-y-2">
								<!-- Progress items will be added here dynamically -->
							</div>
						</div>
					</form>
				</div>

				<!-- Recent Uploads -->
				<div class="mt-10 border-t border-gray-200 pt-10">
					<h3 class="text-lg font-medium text-gray-900 mb-4">Recent Uploads</h3>
					<div class="grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4">
						@MediaItem("image1.jpg", "/static/uploads/image1.jpg", "image", "2.3 MB")
						@MediaItem("document.pdf", "/static/uploads/document.pdf", "pdf", "1.5 MB")
						@MediaItem("photo.png", "/static/uploads/photo.png", "image", "3.7 MB")
						@MediaItem("report.docx", "/static/uploads/report.docx", "doc", "245 KB")
					</div>
				</div>

				<!-- Media Library Link -->
				<div class="mt-8 text-center">
					<a href="/admin/media" class="text-indigo-600 hover:text-indigo-500 font-medium">
						View full media library â†’
					</a>
				</div>
			</div>
		</div>

		<!-- Upload Script -->
		<script>
			// File upload handling with Alpine.js
			document.addEventListener('alpine:init', () => {
				Alpine.data('uploader', () => ({
					dragover: false,
					
					handleDrop(e) {
						e.preventDefault();
						this.dragover = false;
						const files = e.dataTransfer.files;
						this.handleFiles(files);
					},
					
					handleFiles(files) {
						// Show upload progress
						document.getElementById('upload-progress').classList.remove('hidden');
						
						// Handle file upload here
						console.log('Files to upload:', files);
						
						// In a real implementation, you would:
						// 1. Show progress bars for each file
						// 2. Upload files via AJAX
						// 3. Update the UI with results
					}
				}));
			});
		</script>
	}
}

templ MediaItem(name, url, fileType, size string) {
	<div class="group relative">
		<div class="bg-gray-100 rounded-lg overflow-hidden aspect-w-1 aspect-h-1">
			if fileType == "image" {
				<img src={ url } alt={ name } class="object-cover" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2UyZThmMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM2Yjc5OGYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkltYWdlPC90ZXh0Pjwvc3ZnPg=='"/>
			} else {
				<div class="flex items-center justify-center h-full">
					if fileType == "pdf" {
						<svg class="h-16 w-16 text-red-500" fill="currentColor" viewBox="0 0 24 24">
							<path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M10,19L8,14H10L11.5,17.5L13,14H15L13,19H10Z"/>
						</svg>
					} else if fileType == "doc" {
						<svg class="h-16 w-16 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
							<path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M13,17V13H14.5L16,17H17.5L15.5,12.5L17.4,8H15.9L14.5,11H13V8H11.5V17H13Z"/>
						</svg>
					} else {
						<svg class="h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
						</svg>
					}
				</div>
			}
		</div>
		<div class="mt-2">
			<p class="text-sm font-medium text-gray-900 truncate">{ name }</p>
			<p class="text-xs text-gray-500">{ size }</p>
		</div>
		<div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
			<button class="p-1 bg-white rounded shadow-sm hover:shadow-md">
				<svg class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
				</svg>
			</button>
		</div>
	</div>
}